 :    ********************************* :    *                               * :    * FILE :UADE03                  * :    *                               * :    * PROGRAM :BBC TELESOFT DECODER * :    *                               * :    * DISK :4 LINE DEC              * :    *                               * :    * AUTHOR :MEL                   * :    *                               * :    * DATE CREATED :25/08/81        * :    *                               * :    * DATE CHANGED :8/1/82          * :    *                               * :    * CONTENTS :                    * :    *          GETBYT               * :    *          PUTBYT               * :    *          SAVE                 * :    *          FILSAV               * :    *          FILFET               * :    ********************************* : :      GET BYTE  : :      THIS READS THE NEXT BYTE :      FROM THE INPUT STREAM :      WHICH IS THE DISPLAY RAM :      AND RETURNS IT IN THE ACC :      CHECKS ARE MADE FOR END :      OF 'FILE' : :      AT PRESENT PARITY IS STRIPPED :      ALTHOUGH THIS MAY CHANGE LATER : :    IT FIRST CHECKS A STATUS BYTE :    TO SEE IF THERE ARE ANY BYTES LEFT IN  :    THE SCREEN . IF NOT IT LOADS FF AND RETURNS :    USES 3 BYTE ADDRESS,2 BASE AND 1 OFFSET :    IT INCREMENTS THIS ADDRESS AFTER THE BYTE :    IS GOT AND ALTERS THE STATUS BYTE IS :    IF PAST THE END OF SCREEN . :      ALSO THIS IS THE POINT TO :      ACCUMULATE A CHECKSUM : :      INPUTS - CIPPTR :               CURINP :               CIPSTA : :      OUTPUTS - CHAR IN ACC :                FF IF EOF : : :GETBYT BIT CIPSTA  CHECK BIT 6 SET : BVS GBGOOD OTHERWISE FILE EMPTY : LDAIM $FF  SO SIGNAL ON RETURN : RTS    WITH -1 : :GBGOOD LDYZ CIPPTR  LOAD THE OFFSET : LDAIY CURINP  NOW LOAD THE CHARACTER : ANDIM $7F  STRIP PARITY : INY  POINT TO NEXT CHARACTER : BNE GBSAME  CHECK IF NEED TO CHANGE : PHA   SAVE THE BYTE ON THE STACK : INCZ CURINP +01  THE BASE ADDRESS : LDAZ CURINP +01  AND CHECK NOT EOF : CMPIM TOPSCR /  AT TOP OF SCREEN : BNE GBRELO  OK SO OUT : LDAIM $00  OTHERWISE CLEAR STATUS : STAZ CIPSTA :GBRELO PLA   RELOAD THE BYTE :GBSAME STY CIPPTR  SAVE NEW POINTER VALUE : CMPIM $20   CHECK NOT A CONTROL CHAR : BCS GBEXIT : LDAIM $2A  REPLACE WITH STAR * (42) :GBEXIT RTS  NORMAL EXIT : : :    ((END OF GETBYT : : :    PUT BYTE :    THIS PUTS THE BYTE INTO BUFFER :    DEFINED BY ADDRESS CUROUT : :    INPUTS - CHARACTER IN ACC : :    OUTPUTS - NONE : :    REGISTERS USED : ACC , Y : : :PUTBYT LDY COPPTR  LOAD THE INDEX : STAIY CUROUT  SAVE THE BYTE IN THE BUFFER : INY  BUMP THE INDEX : BNE PBSAME  IF NO OFLOW GO OUT : INC CUROUT +01  BUMP BASE ADDRESS :PBSAME STY COPPTR  SAVE THE INDEX : RTS  EXIT : : :    ((END OF PUTBYT : : :    PAGE ZERO REDEFINITIONS : :NAMADD * PARAM +09 :RELADD * PARAM +0B :EXEADD * PARAM +0F :STAADD * PARAM +13 :ENDADD * PARAM +17 : : : : : : :    FILSAV - SAVE A PAGE ON DISK AS A :    FILE  NAMED TTXTNNN WHERE THE NNN :    IS THE PAGE NUMBER :    NOTE THIS IS CHEAP AND CHEERFUL :    AT PRESENT AND DOESN'T ALLOW SUB :    PAGES AS BBC FORMAT : : : :FILSAV LDAIM SCRST   SET UP THE LOW BYTES : STAZ RELADD    OF THE OSSAVE PACKET : STAZ EXEADD : STAZ STAADD : LDAIM HIGSCR : STAZ ENDADD : LDAIM SCRST / : STA RELADD +01 : STA EXEADD +01 : STA STAADD +01 : SEC : LDAZ STACUR    NOW FIND START OF NAME : SBCIM $04    IN THE COMMAND STRING : STAZ NAMADD : LDAZ STACUR +01 : SBCIM $00 : STAZ NAMADD +01 : LDAIM HIGSCR / : STAZ ENDADD +01 : LDXIM NAMADD : LDAIM $00 : TAY : JSR OSFILE   SAVE THE FILE : RTS : : : :    (END OF FILSAV : : : : :    FILFET RETRIEVE A PAGE FROM THE FILE :    SYSTEM WITH NAME TTXTNNN WHERE :    NNN IS THE PAGE NUMBER : : :FILFET LDAIM SCRST : STAZ RELADD : LDAIM $00 : STAZ EXEADD   OVERRIDE RELOAD ADDRESS : LDAZ STACUR : SEC : SBCIM $04 : STAZ NAMADD : LDAZ STACUR +01 : SBCIM $00 : STAZ NAMADD +01 : LDAIM SCRST / : STAZ RELADD +01 : LDXIM NAMADD : LDAIM $80    LOAD THE FILE : LDYIM $00 : JSR OSFILE : RTS : : :   (END OF FILFET : : :