 :    ********************************* :    *                               * :    * FILE :UADE05                  * :    *                               * :    * PROGRAM :BBC TELESOFT DECODER * :    *                               * :    * DISK :4 LINE DEC              * :    *                               * :    * AUTHOR :MEL                   * :    *                               * :    * DATE CREATED :25/08/81        * :    *                               * :    * DATE CHANGED :8/1/82          * :    *                               * :    * CONTENTS :MAIN CODE           * :    ********************************* : : :START JSR INIT  SET UP : : JSR HELP    DISPLAY COMMANDS  :MAINA JSR GETCOM  GET COMMANDS : JSR CLRSCR  NOW CLEAR ROWS 1-24 : :MAINC BIT $00FF   LOOK TO SEE IF AN ESCAPE : BMI MAINA    HAS BEEN SENT :   AND GET A COMMAND IF SO : : : : JSR RDMRAG  READ THE MRAG UNTIL A HEADER : BEQ MAINZ  YES SO GO ON : JSR BMPROW  OTHERWISE POINT TO NEXT ROW : JMP MAINC  TRY AGAIN : :    GOT A HEADER : :MAINZ JSR RDCTRL  PULL IN CONTROL BYTES : LDAIM $04  if INT SEQ TRUE : BITZ CTRLA : BNE MAINE : : LDAZ MAGSC    and MAGAZINE IS SAME : CMPZ MAGZRD : BEQ MAIND : : LDAIM $01  and NOT MAG SERIAL : BITZ CTRLB : BEQ MAINE : :MAIND LDAIM $20  then DISPLAY HEADER : STAZ XFRCNT  LOAD COUNT : LDAIM SCRST /  START AT $0408 : STAZ DSTADD +01 LOAD TOP BYTE OF SCREEN : LDAIM $08  AND PUT INCREMENT INTO LOW BYTE : STAZ DSTADD : JSR TRANSF :    JMP MAINB   NOW ONTO CHECK HEADER : :    DISPLAY TIME IF HEADER SUPPRESSED : :    MAINE LDXIM $18   FIRST SKIP ALL BYTES :    MNELP LDA DATINP   IN THE HEADER BEFORE :   DEX    THE DATE PORTION :   BNE MNELP   THEN TRANSFER THAT PART :   LDAIM $08    WITH THE TIME IN IT :   STAZ XFRCNT :   LDAIM SCRST /   TO THE END OF THE :   STAZ DSTADD +01   HEADER ROW :   LDAIM $20    THIS IS THE OFFSET :   STAZ DSTADD :   JSR TRANSF : :    THE TIME DISPLAY CODE MAKES :    THE TIME DISPLAY JITTER SO IT :    HAS BEEN REMOVED . AN INTERRUPT :    DRIVEN TEST WILL BE TRIED : :    (16/10/81) : : :    NOW CHECK IF THE HEADER IS THE ONE WANTED :MAINE       NEEDS THIS AS TIME CODE REMOVED : :MAINB JSR BMPROW  PUSH TO NEXT ROW : LDAZ MAGSC  NOW CHECK HEADER : CMPZ MAGZRD : BNE MAINC : LDAZ PTNSC : CMPZ PTNRD : BNE MAINC  IT MAY NOT BE THE ONE WANTED : LDAZ PUNSC : CMPZ PUNRD : BNE MAINC : LDAZ TMMTN  CHECK IF ERASE BIT SET : ANDIM $08  IN TIME MIN TENS BYTE : BEQ MAINF  NO GO ON : JSR CLRSCR  YES SO LEAVE HEADER : : :   NOW LOOK FOR A COMPLETE PAGE : :MAINF JSR MRAGGG  GET A ROW HEADER : BNE MAING  IT MAY BE A PAGE HEADER (ROW0) : JSR RDCTRL  IN WHICH CASE READ CONTROL BYTES : JMP MAINH  AND GO AND SEE WHICH PAGE HEADER : :MAING LDAZ MAGSC  CHECK IF ORDINARY ROW : CMPZ MAGZRD  IS THE SAME MAGAZINE : BEQ MAINY  OK CONTINUE : JSR BMPROW  OTHERWISE IGNORE AS  : JMP MAINF  INTERLEAVED ROWS : :MAINY LDAIM $28  OK TRANSFER 40 BYTES : STAZ XFRCNT :   NOW CALCULATE THE REAL ADDRESS :   FOR THE VDU FROM THE ROW NUMBER :   THIS IS 40 TIMES ROW NUMBER : LDAZ ROWRD : CMPIM $19  NOW CHECK NOT ABOVE ALLOWED ROW : BCC MAINX  ASSUME A SILLY LINE AND IGNORE : JSR BMPROW  IE GO TO NEXT ROW : JMP MAINF :   HERE IS WHERE ROWS ABOVE 24 CAN BE DETECTED :   IN TELESOFTWARE FORMATS : :MAINX TAX   NOW USE IT AS AN INDEX : LDAAX ROWBOT  PICK BOTTOM BYTE ROW*40 : STAZ DSTADD : LDAAX ROWTOP  PICK UP TOP BYTE ROW*40 : CLC   PREPARE TO ADD VDU BASE : ADCIM SCRST /  BUT ONLY TO TOP BYTE : STAZ DSTADD +01 NOW A COMPLETE VDU ADDRESS :   SO NOW : JSR TRANSF  MOVE ROW : :MAINH JSR BMPROW  MOVE TO NEXT ROW START : LDAZ STATUS  NOW LOOP until : BNE MAINF  A HEADER : :    START OF TELESOFT PATCH : LDAZ MAGSC : CMPZ MAGZRD  and SAME MAGAZINE : BNE MAINF :    END OF TELESOFT PATCH : LDAZ PTNSC : CMPZ PTNRD  and DIFFERENT PAGE : BNE MAINI : LDAZ PUNSC : CMPZ PUNRD  (REMEMBER BOTH DIGITS) : BEQ MAINF : :MAINI LDXZ SWITCH  SEE WHAT ACTION TO TAKE : BEQ BRC  NORMAL DECODER : DEX  CHECK VALUE 1 : BEQ BRB  BBC DECODER : DEX  CHECK VALUE 2 : BEQ BRA  ALTERNATIVE DECODER : LDXIM $00  ANY OTHER IS WRONG : STXZ SWITCH  SO RESET SWITCH TO NORMAL : JMP MAINC   AND LOOP : :BRC JSR ADJDSP   SORT OUT DOUBLE HEIGHT : JMP MAINC  LOOP ON PAGE GETTING :BRB JMP BBCDEC  DECODE PAGE :BRA JMP MAINC  IGNORE THIS COMMAND :    JMP MALDEC  DECODE MAL PAGES : : : : :   ((END OF MAIN PROGRAM : :