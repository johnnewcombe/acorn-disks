{ FSRND  File Server random access }SEGMENT fsrnd;{$Ifsdecs}{$Ifsext}{$Ifsp1e}{$Ifsdatae}PROCEDURE Set_ptr(VAR fbk:Fcb;new_ptr:Dbl_word;VAR error:Byte);{Sets the new pointer into the FCB, updating the current block number}VARc_ent:Byte;b_no:Word;bl_des:Block_descrip;BEGINerror:=0;WITH fbk DO BEGIN  b_no:=new_ptr DIV blk_size; {Block offset in file}  b_no:=Land(b_no,8191);  c_ent:=Cache_entry(DDA.block,TRUE,error);  IF exploded IN cache[c_ent].dir_ent[DDA.offset].flags THEN BEGIN    {Exploded}    bl_des.blk:=cache[c_ent].dir_ent[DDA.offset].blk_list[b_no DIV 512];    IF bl_des.blk=0 THEN curr_blk:=0             {512=blocknos per exp.block}    ELSE BEGIN      bl_des.drive:=DDA.block.drive;      c_ent:=Cache_entry(bl_des,TRUE,error);      b_no:=Land(b_no,(blk_size DIV 2)-1);  {Bring into range for this EB list}      curr_blk:=cache[c_ent].EB_list[b_no]    END  END ELSE BEGIN    {Not exploded}    IF b_no>15 THEN curr_blk:=0    ELSE curr_blk:=cache[c_ent].dir_ent[DDA.offset].blk_list[b_no]  END;  IF error<>0 THEN curr_blk:=0 ELSE Make3(ptr,new_ptr)ENDEND;BEGINEND.