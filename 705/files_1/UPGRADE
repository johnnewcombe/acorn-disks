.x||\ Upgrade|y|u|cNotes on upgrading to 'level 2' File Server** NOTE : READ THIS AND PERFORM ALL DISC CONVERSION BEFORE EXCHANGING CIRCUIT BOARDS **|u 1. IntroductionVersions of the SJ Research File Server prior to version 0.20 were interim versions, retaining CP/M as the filing system at the heart of the server software on the 380Z.  Current versions are very substantially different in performance, facilities offered, and internal design.  Whilst not all intended features are currently implemented, the design is complete and future changes will not require the same sort of conversion as the current change from level 1 to level 2.|u 2. Disc formatsThe major operating change to upgrade from level 1 to level 2 is the conversion of disc formats.  The level 1 file server used the disc format of CP/M, and hence the standard 380Z format and copy utilities could be used.  To allow for the full expansion of facilities, a completely new format is required and a new utility is provided to format and copy the new format discs.  In addition, a utility is provided to read old format discs and write their contents onto new format discs.  The capacity of new format discs is now 100K per side as oppposed to 72K (assuming standard 40 Track drives).|u 2.1 FSUTILA new disc is prepared for use with the file server using FSUTIL.  For all file server purposes, a disc is considered as a single unit and the two sides are combined, invisibly to the user, to form a single filing system.  The two physical drives remain distinct, but are identified by the names of the discs in them.  FSUTIL initialises the disc, recording the name, size, number of sides and accounting information.  An option in FSUTIL allows the system manager to adjust thee space allowed on the disc for each user's account.  A utility is provided on the network utilities disc such that any user on a BBC computer may find the balance of his accounts by running the program *STATEMENT.The other function of FSUTIL is to copy entire discs for backup purposes, in the style of the 380Z 'FASTCOPY' utility.  The copy option takes a file server format disc and makes an identical copy on another disc.|u 2.2 Converting discs - FSCONV.The program FSCONV is provided to copy the contents of a disc written under FS 0.13 or similar onto a new format disc.  The new disc must be formatted with FSUTIL before running FSCONV.  If the accounting systems are being used, directories should be set up and allocated account numbers on the new disc before converting.  Each file will be written to a directory corresponding to the three letter directory name used with the old server, and if this does not already exist, it will be created with account number zero.  If a directory already exists, files recorded in it will be charged to the account number of that directory.  To set up the directories, the file server should be started with the new disc inserted, and the system manager should log on  *I AM SYST  .  He will now have access to all accounts, and will have $ (the root of the directory tree) selected.  To set up a directory called JOE, the commands  *CDIR JOE  ,  *ACCOUNT JOE 1  should be used.  The account numbers are two-digit hexadecimal numbers, but in practice the decimal numbers 0-99 are usually sufficient to give all users unique numbers.FSCONV has certain limitations.  Files longer than 32K bytes will not be copied.  If a file of the same name already exists on the destination disc, a file will not be copied.  This may occur if both sides of an old format disc are copied onto the same new format disc - the screen display during copying indicates which files are successfully copied.  It is possible to try copying the disc, rename any failures and then copy again : all the files which originally copied will now fail to write a second copy, but the re-named file will hopefully succeed.  Under the old file server, it was possible to create files with illegal names, containing delete characters or flashing control characters.  These will be rejected at the copy stage, as will any containing the special characters $ % # * : or <full stop>.The new discs produced by the conversion process are in no way special, and so new directories not conforming to the old three letter limit may be set up, libraries may be created and more than two levels of directory may be used freely.** NOTE THAT FSCONV WILL ONLY RUN ON OLD (issue 1 or 2) ECONET BOARDS **It is, however, possible to run FS0.13 on new issue boards, so files cane be copied from old to new format by running FS0.13, loading them into the client computers, starting up a new FS and saving the files back.|u 3. Level two facilities.Levels one and two are terms coined by Acorn to describe their versions of file server, but the SJ Research file servers approximately fit these categories also.  The SJ Research level 1 file server provided roughly the same facilities as the Acorn level one, but with the addition of logging-on and directories to give some of the 'flavour' of a level two system.  It also supported saving of long files.  The SJ Research level one file server is now obsolete, and users are encouraged (if any encouragement is required!) to convert to the new system.  The Acorn level one server remains as their entry-level product for reasons of cost.All level two file servers offer random access files, a heirarchical directory structure (ie. directories within directories to group files by ownership or whatever categories are desired, to any depth).  A library facility is provided, such that utility programs (eg. *NOTIFY) may be used immediately without being kept in the current directory.  On the SJ Research file server, any files may be accessed in this way, including BASIC programs and data files, whereas the Acorn system limits this to *COMMAND programs.  Access controls are provided to protect files from the owner or other users.  This combination of facilities has been described as an 'Advanced filing System' (AFS), but it is not clear whether this is official Acorn terminology.Passwords provide security for user's files - each user has a password which may be changed at any time, and must be quoted at log-on time.  Each user also has a boot option which determines whether the file !BOOT should be loaded, *RUN, or *EXEC'd after logging on.  Note that on an SJ Research file server, the file !BOOT may be in the library, to give a 'message of the day' facility.It should be noted that random access to files (as opposed to LOAD/SAVE) can produce performance problems if access is a single byte at a time.  EXTREMELY LARGE performance improvements can be made by using OSBGBP on the BBC computer to access groups of bytes (even a group of 16 bytes at once may increase speed by ten times or more).  With appropriate use of OSBGBP, programs may actually run faster through the network than with local DFS, but single byte access (as produced by BGET, BPUT, PRINT# in BASIC will be found unsatisfactory for other than small files.  At present, the only way around this is to write the programs to use OSBGBP (which is the better method in any case, and applications software designers are being pursuaded to do this by many users as well as Acorn and SJ Research).  It is hoped to provide in due course a utility program which will add on random access buffering to existing programs.Whilst these random access problems apply to all file servers, the present SJ Research file server is about 30% slower than the current Acorn level 2 server.  It is anticipated that speed can be increased by about 1.5 to 2 times by hand-compiling the relavent code in the server, but there are fundamental restrictions to improving much further than this.|gupgrad1